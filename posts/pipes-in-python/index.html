<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>Pipes in Python - sulami's blog</title>
        <link rel="stylesheet" type="text/css" href="../../stylesheet.css" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="apple-touch-icon" sizes="180x180" href="../../images/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="../../images/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="../../images/favicon-16x16.png">
        <link rel="manifest" href="../../images/site.webmanifest">
        <link rel="mask-icon" href="../../images/safari-pinned-tab.svg" color="#5bbad5">
        <link rel="shortcut icon" href="../../images/favicon.ico">
        <meta name="msapplication-TileColor" content="#da532c">
        <meta name="msapplication-config" content="/images/browserconfig.xml">
        <meta name="theme-color" content="#5bbad5">
        <link href="../../atom.xml" type="application/atom+xml" rel="alternate" title="sulami's blog feed" />
    </head>
    <body>
        <input type="checkbox" id="lightswitch" />
        <div id="body">
        <div id="container">
        <div id="header">
            <div id="navigation">
                <label for="lightswitch" id="lightswitch-label">☀</label>
                ·
                <a href="../../">Home</a>
                ·
                <a href="../../archive/">Archive</a>
                ·
                <a href="../../atom.xml">Feed</a>
                ·
                <a href="../../pages/about/">About</a>
                ·
                <a href="../../pages/cv/">CV</a> <a href="../../pages/robin-schroer-cv.pdf">(PDF)</a>
                ·
                <a href="../../pages/uses-this/">Uses This</a>
                ·
                <a href="../../pages/frankenwm/">FrankenWM</a>
            </div>
        </div>

        <div id="content">
            <article>
                <h1>Pipes in Python</h1>
                <div class="info">
                    
                        Posted on August 21, 2018
                    
                    
                </div>

                <section>
            <p>I just found <a href="https://hackernoon.com/adding-a-pipe-operator-to-python-19a3aa295642">an article about pipes in Python</a> on lobste.rs and was reminded that I was toying with the exact same thing recently. Using a lot of functional languages (mainly Haskell, Clojure, Elixir)<span><label for="sn-1" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-1" class="margin-toggle" /><span class="sidenote">… but being paid to write (mostly highly object-oriented) Python four out of five days a week. We do use some Elixir at my place, but we are still a Python shop first.<br />
<br />
</span></span> and also a fair bit of bash, I am very used to streaming data through chains of functions using pipe-like constructs. Python does make this quite difficult and encourages a more imperative approach with intermediate variables.</p>
<p>The author of the article above uses AST rewriting, which I have to admit is very clever, though hard to introspect and extend unless you are already familiar with AST manipulation in Python.</p>
<p>My approach is slightly different, and yields a less pretty syntax, but is arguably more flexible and extensible, by using a plain function. The definition currently looks like this:</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="kw">def</span> pype(x, <span class="op">*</span>fs):
    <span class="co">&quot;&quot;&quot;</span>
<span class="co">    Pipe function. Takes an initial value and any number of functions/methods.</span>
<span class="co">    Methods as strings. Additional args are supported for functions &amp; methods</span>
<span class="co">    by suppling a step as a tuple/list with function/method as the first</span>
<span class="co">    element and the args as the rest. The pipe input is used as the last</span>
<span class="co">    argument in this case. Currently no kwargs.</span>
<span class="co">    &quot;&quot;&quot;</span>
    <span class="cf">while</span> fs:
        f <span class="op">=</span> fs[<span class="dv">0</span>]
        args <span class="op">=</span> []
        <span class="cf">if</span> <span class="bu">isinstance</span>(f, (<span class="bu">list</span>, <span class="bu">tuple</span>)):
            args <span class="op">=</span> <span class="bu">list</span>(f[<span class="dv">1</span>:])
            f <span class="op">=</span> f[<span class="dv">0</span>]
        <span class="cf">if</span> <span class="bu">isinstance</span>(f, <span class="bu">str</span>):
            <span class="cf">if</span> f.startswith(<span class="st">'.'</span>):
                x <span class="op">=</span> <span class="bu">getattr</span>(x, f[<span class="dv">1</span>:])(<span class="op">*</span>args)
            <span class="cf">else</span>:
                x <span class="op">=</span> x[f]
        <span class="cf">elif</span> <span class="bu">isinstance</span>(f, <span class="bu">int</span>):
            x <span class="op">=</span> x[f]
        <span class="cf">else</span>:
            x <span class="op">=</span> f(<span class="op">*</span>args <span class="op">+</span> [x])
        fs <span class="op">=</span> fs[<span class="dv">1</span>:]
    <span class="cf">return</span> x</code></pre></div>
<p>The docstring is a bit abstract, so I think an example is much more explanatory:</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="im">from</span> pype <span class="im">import</span> pype

<span class="kw">def</span> add_suffix(number, s):
    <span class="cf">return</span> <span class="st">'</span><span class="sc">{}</span><span class="st"> is </span><span class="sc">{}</span><span class="st"> cool!'</span>.<span class="bu">format</span>(
        s,
        <span class="st">' '</span>.join(<span class="st">'very'</span> <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(number))
    )

pype(
    <span class="st">'   abc: </span><span class="sc">{}</span><span class="st">   '</span>,
    <span class="st">'.strip'</span>,
    (<span class="st">'.format'</span>, <span class="dv">3</span>),
    (add_suffix, <span class="dv">2</span>),
    <span class="st">'.upper'</span>,
)

<span class="co"># 'ABC: 3 IS VERY VERY COOL!'</span></code></pre></div>
<p>I am aware this is a very constructed example, but you get the idea. It currently does not handle keyword arguments, and you cannot specify in which place you would like the input argument to go, it always takes the last slot, which isn’t always convenient, but this way you can avoid using =lambda=s everywhere, which are quite long in Python<span><label for="sn-2" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-2" class="margin-toggle" /><span class="sidenote">I quite enjoy Elixir’s solution: <code>&amp;func(1, &amp;1, 3)</code>, <code>&amp;1</code> being the placeholder.<br />
<br />
</span></span>.</p>
<p>I might extend this further in the future and maybe introduce it into some code bases of mine, if it turns out to be useful.</p>
                </section>
        </div>
        <div id="footer">
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>
        </div>
        </div>
        <!-- Below is some JS, the only on this page. Things should be -->
        <!-- generally fine if you block it, but I'm adding notes so you -->
        <!-- can decide how you feel about each element. -->
        <!-- Colour theme switcher -->
        <script>
          const themeSwitch = document.querySelector('#lightswitch');
          themeSwitch.checked = localStorage.getItem('switchedTheme') === 'true';

          themeSwitch.addEventListener('change', function (e) {
              if(e.currentTarget.checked === true) {
                  // Add item to localstorage
                  localStorage.setItem('switchedTheme', 'true');
              } else {
                  // Remove item if theme is switched back to normal
                  localStorage.removeItem('switchedTheme');
              }
          });
        </script>
        <!-- Privacy-aware analytics by https://www.goatcounter.com/ -->
        <script data-goatcounter="https://sulami-blog.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
    </body>
</html>
